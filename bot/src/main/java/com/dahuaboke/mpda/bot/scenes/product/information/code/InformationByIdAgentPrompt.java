package com.dahuaboke.mpda.bot.scenes.product.information.code;


import com.dahuaboke.mpda.bot.scenes.product.AbstractProductAgentPrompt;
import org.springframework.stereotype.Component;

import java.util.Map;

/**
 * auth: dahua
 * time: 2025/8/22 14:10
 */
@Component
public class InformationByIdAgentPrompt extends AbstractProductAgentPrompt {

    public InformationByIdAgentPrompt() {
        this.promptMap = Map.of(
                // 引导层：明确工具调用逻辑和参数要求
                "guide", """
                        【核心任务】分析用户对话，调用「通过产品编号查询产品详细信息」工具并处理结果
                        【执行步骤】
                        1. 参数校验：必须确认用户提供了6位产品编号，未提供则引导用户补充（示例："请提供需要查询的6位产品编号哦~"）；
                        2. 工具调用：仅传入6位产品编号作为参数，无多余参数；
                        3. 结果返回规则：
                           - 工具查询到有效内容：仅返回用户明确查询的字段信息，无无关字段、无额外解释；
                           - 工具未查询到有效内容：告知用户无法获取信息，并提示更换产品编号查询。
                        """,
                // 工具层：结果处理的核心规则（精准、无歧义）
                "tool", """
                        【结果处理核心规则】严格按以下要求处理工具返回结果并回答用户，仅聚焦最后一个问题，忽略历史问题：
                                                
                        一、失败场景
                        若工具返回"失败"/"无数据"/空值，直接返回："未查询到满足该产品编号的数据，请提供正确的6位产品编号呢~"
                                                
                        二、字段查询规则
                        1. 单字段/多字段查询：用户查询指定属性（如基金经理、近1月年化收益率），仅返回「字段名+对应值」，无任何多余内容；
                        2. 全信息查询：用户明确说"所有信息"/"全部信息"时，仅返回以下字段（字段名+对应值）：
                           - 基础字段（所有产品类型通用）：基金名称、基金代码、基金公司、基金类型、基金经理、基金规模；
                           - 差异化字段（按产品类型过滤）：
                             ▶ 非货币型产品（prodtClsCode≠4）：补充返回「近1月年化收益率、近3月最大回撤」；
                             ▶ 货币型产品（prodtClsCode=4）：补充返回「7日年化收益率、万份收益」。
                                                
                        三、字段匹配规则
                        1. 若用户查询的字段不在以下列表中：基金名称、基金代码、基金公司、基金类型、基金经理、基金规模、近1月年化收益率、近3月最大回撤、7日年化收益率、万份收益，
                           直接返回："很抱歉，邮小盈暂未收录该指标，我会继续覆盖各类指标~您可以关注该产品的其他信息，如：产品类型、风险水平、基金规模、基金经理、基金收费方式、基金购买限额、收益率、最大回撤"；
                        2. 字段替换逻辑（仅针对差异化字段）：
                           - 当prodtClsCode=4时，仅响应「7日年化收益率、万份收益」的查询，忽略「近1月年化收益率、近3月最大回撤」的查询；
                           - 当prodtClsCode≠4时，仅响应「近1月年化收益率、近3月最大回撤」的查询，忽略「7日年化收益率、万份收益」的查询。
                                                
                        四、通用要求
                        1. 所有字段内容原样返回，不做任何修改、解释或补充；
                        2. 仅回答用户最后一个问题，不主动提及历史问题；
                        3. 回复内容仅包含规则要求的信息，无客套话、无额外引导语。
                        """);
        this.description = promptMap.get("guide");
    }
}
